<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="From CTFs to Real-World Exploitation: Root Cause Analysis of CVE-2017-14493 in dnsmasq" />
<meta property="og:locale" content="en" />
<meta name="description" content="[CVE-2017-14493 ] Root Cause Analysis on vulnerable dnsmasq software." />
<meta property="og:description" content="[CVE-2017-14493 ] Root Cause Analysis on vulnerable dnsmasq software." />
<link rel="canonical" href="https://t1b4n3.github.io/post/RCA-CVE-2017-14493/" />
<meta property="og:url" content="https://t1b4n3.github.io/post/RCA-CVE-2017-14493/" />
<meta property="og:site_name" content="t1b4n3" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2026-02-19T00:00:00+02:00" />
<meta property="og:image" content="https://t1b4n3.github.io/assets/images/art.png" /><meta name="twitter:card" content="summary_large_image" />
      <meta property="twitter:image" content="https://t1b4n3.github.io/assets/images/art.png" />
<meta property="twitter:title" content="From CTFs to Real-World Exploitation: Root Cause Analysis of CVE-2017-14493 in dnsmasq" />
<meta name="twitter:site" content="@t1b4n3" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2026-02-19T00:00:00+02:00","datePublished":"2026-02-19T00:00:00+02:00","description":"[CVE-2017-14493 ] Root Cause Analysis on vulnerable dnsmasq software.","headline":"From CTFs to Real-World Exploitation: Root Cause Analysis of CVE-2017-14493 in dnsmasq","mainEntityOfPage":{"@type":"WebPage","@id":"https://t1b4n3.github.io/post/RCA-CVE-2017-14493/"},"url":"https://t1b4n3.github.io/post/RCA-CVE-2017-14493/"}</script>
<!-- End Jekyll SEO tag -->


  <title>From CTFs to Real-World Exploitation: Root Cause Analysis of CVE-2017-14493 in dnsmasq | t1b4n3
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">



  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->

  <script src="/assets/js/dist/theme.min.js"></script>

  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js,npm/tocbot@4.36.4/dist/tocbot.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/me.jpeg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">t1b4n3</a>
    <p class="site-subtitle fst-italic mb-0">Exploring low-level development and the craft of pwning.</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/projects/" class="nav-link">
            <i class="fa-fw fas fa-code"></i>
            

            <span>PROJECTS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    

      
        <a
          href="https://github.com/t1b4n3"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    

      
        <a
          href="https://twitter.com/t1b4n3"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-x-twitter"></i>
        </a>
      
    

      
        <a
          href="javascript:location.href = 'mailto:' + ['nkatekotibane101','gmail.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
          
      

      
        <a
          href="https://www.linkedin.com/in/nkatekotibane"
          aria-label="linkedin"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-linkedin"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>From CTFs to Real-World Exploitation: Root Cause Analysis of CVE-2017-14493 in dnsmasq</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link" aria-label="Search">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  




<!-- return -->










<article class="px-1" data-toc="true">
  <header>
    <h1 data-toc-skip>From CTFs to Real-World Exploitation: Root Cause Analysis of CVE-2017-14493 in dnsmasq</h1>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1771452000"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Feb 19, 2026
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://twitter.com/t1b4n3">Nkateko Tibane</a>
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="1545 words"
>
  <em>8 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  
    <div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">From CTFs to Real-World Exploitation: Root Cause Analysis of CVE-2017-14493 in dnsmasq</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
    </div>

    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">Contents</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>

    <dialog id="toc-popup" class="p-0">
      <div class="header d-flex flex-row align-items-center justify-content-between">
        <div class="label text-truncate py-2 ms-4">From CTFs to Real-World Exploitation: Root Cause Analysis of CVE-2017-14493 in dnsmasq</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
      </div>
      <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog>
  

  <div class="content">
    <h1 id="cve-2017-14493--root-cause-analysis-on-vulnerable-dnsmasq-software">[CVE-2017-14493 ] Root Cause Analysis on vulnerable dnsmasq software.</h1>

<p>This is my first step of moving from CTFs to Real World Vulnerabilities. My goal  is to move from exploiting CTFs to real world software such has dnsmasq and eventually both the linux and andriod kernel.</p>

<h2 id="lab-setup"><span class="me-2">Lab Setup.</span><a href="#lab-setup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>I will be running the vulnerable software on a kali virtual machine using virtualbox, and i will use my ubuntu machine as the attacker machine.</p>

<p>First lets download the vulnerable software version ( &lt; 2.78)</p>

<div class="language-sh highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> wget https://dnsmasq.org/dnsmasq-2.77.tar.xz
</pre></td></tr></tbody></table></code></div></div>

<p>Then i first compiled it with out security mitigations.</p>

<div class="language-sh highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>make <span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">"-O0 -g -fno-stack-protector -z execstack -no-pie -Wno-error=incompatible-pointer-types -Wno-error=deprecated-non-prototype -fpermissive"</span> <span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">"-z execstack -no-pie"</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Then I set up my network interfaces on both machines so that i can use a IPv6 address (since the vulnerabilities are in DHCPv6)</p>

<p>Kali:</p>
<div class="language-sh highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>ip <span class="nt">-6</span> addr add 2001:db8::1/64 dev eth0
</pre></td></tr></tbody></table></code></div></div>
<p>Ubuntu:</p>
<div class="language-sh highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>ip <span class="nt">-6</span> addr add 2001:db8::1/64 dev wlp4s0
</pre></td></tr></tbody></table></code></div></div>

<p>So To find the where the vulnerable code/code path is I will use a debugger (gdb with gef extension).</p>

<p>So lets start with CVE-2017-14493.</p>
<h2 id="cve-2017-14493"><span class="me-2">CVE-2017-14493</span><a href="#cve-2017-14493" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p><a href="https://nvd.nist.gov/vuln/detail/cve-2017-14493">CVE Description:</a> Stack-based buffer overflow in dnsmasq before 2.78 allows remote attackers to cause a denial of service (crash) or execute arbitrary code via a crafted DHCPv6 request.</p>

<p>To find where the vulnerability is lets run they program while its attached to a debugger and run the <a href="https://github.com/google/security-research-pocs/blob/master/vulnerabilities/dnsmasq/CVE-2017-14493.py">PoC</a> and analyse it from there.</p>

<p>To make this easier I copied the necessary source code into the folder <code class="language-plaintext highlighter-rouge">dnsmasq-2.77/src</code> and then I used GDB script with the following commands.</p>

<pre><code class="language-gdb">directory dnsmasq-2.77/src/
set follow-exec-mode new
set breakpoint pending on
run -d -i wlp4s0 --dhcp-range=2001:db8::10,2001:db8::ae,64 --enable-ra
</code></pre>

<p>As we find interesting code paths we will use this gdb script to but breakpoints in the source code.</p>

<p>Then run gdb with this script.</p>

<div class="language-sh highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>gdb ./dnsmasq <span class="nt">-x</span> ./gdb_cmds
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/images/research/cve-2017-14493/running_gdb.png" class="popup img-link shimmer"><img src="/assets/images/research/cve-2017-14493/running_gdb.png" alt="GDB" loading="lazy"></a></p>

<p>In the attacker machine run the <a href="https://github.com/google/security-research-pocs/blob/master/vulnerabilities/dnsmasq/CVE-2017-14493.py">PoC</a></p>

<div class="language-sh highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>./poc.py 2001:db8::1 547
<span class="c">#./poc.py &lt;ipv6 addr&gt; &lt;port&gt;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/images/research/cve-2017-14493/segfault.png" class="popup img-link shimmer"><img src="/assets/images/research/cve-2017-14493/segfault.png" alt="segfault" loading="lazy"></a>
As we can see that we got a segfault in the <code class="language-plaintext highlighter-rouge">dhcp6_reply()</code>.</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre><span class="kt">unsigned</span> <span class="kt">short</span> 
<span class="nf">dhcp6_reply</span><span class="p">(</span><span class="k">struct</span> <span class="n">dhcp_context</span> <span class="o">*</span><span class="n">context</span><span class="p">,</span> <span class="kt">int</span> <span class="n">interface</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">iface_name</span><span class="p">,</span>
        <span class="k">struct</span> <span class="n">in6_addr</span> <span class="o">*</span><span class="n">fallback</span><span class="p">,</span> <span class="k">struct</span> <span class="n">in6_addr</span> <span class="o">*</span><span class="n">ll_addr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">in6_addr</span> <span class="o">*</span><span class="n">ula_addr</span><span class="p">,</span>
        <span class="kt">size_t</span> <span class="n">sz</span><span class="p">,</span> <span class="k">struct</span> <span class="n">in6_addr</span> <span class="o">*</span><span class="n">client_addr</span><span class="p">,</span> <span class="kt">time_t</span> <span class="n">now</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">struct</span> <span class="n">dhcp_vendor</span> <span class="o">*</span><span class="n">vendor</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">msg_type</span><span class="p">;</span>
        <span class="k">struct</span> <span class="n">state</span> <span class="n">state</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sz</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">msg_type</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">daemon</span><span class="o">-&gt;</span><span class="n">dhcp_packet</span><span class="p">.</span><span class="n">iov_base</span><span class="p">);</span>
        <span class="cm">/* Mark these so we only match each at most once, to avoid tangled linked lists */</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">vendor</span> <span class="o">=</span> <span class="n">daemon</span><span class="o">-&gt;</span><span class="n">dhcp_vendors</span><span class="p">;</span> <span class="n">vendor</span><span class="p">;</span> <span class="n">vendor</span> <span class="o">=</span> <span class="n">vendor</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span>
                <span class="n">vendor</span><span class="o">-&gt;</span><span class="n">netid</span><span class="p">.</span><span class="n">next</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">vendor</span><span class="o">-&gt;</span><span class="n">netid</span><span class="p">;</span>
        
        <span class="n">reset_counter</span><span class="p">();</span>
        <span class="n">state</span><span class="p">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span><span class="p">;</span>
        <span class="n">state</span><span class="p">.</span><span class="n">interface</span> <span class="o">=</span> <span class="n">interface</span><span class="p">;</span>
        <span class="n">state</span><span class="p">.</span><span class="n">iface_name</span> <span class="o">=</span> <span class="n">iface_name</span><span class="p">;</span>
        <span class="n">state</span><span class="p">.</span><span class="n">fallback</span> <span class="o">=</span> <span class="n">fallback</span><span class="p">;</span>
        <span class="n">state</span><span class="p">.</span><span class="n">ll_addr</span> <span class="o">=</span> <span class="n">ll_addr</span><span class="p">;</span>
        <span class="n">state</span><span class="p">.</span><span class="n">ula_addr</span> <span class="o">=</span> <span class="n">ula_addr</span><span class="p">;</span>
        <span class="n">state</span><span class="p">.</span><span class="n">mac_len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">state</span><span class="p">.</span><span class="n">tags</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
        <span class="n">state</span><span class="p">.</span><span class="n">link_address</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">dhcp6_maybe_relay</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="p">,</span> <span class="n">daemon</span><span class="o">-&gt;</span><span class="n">dhcp_packet</span><span class="p">.</span><span class="n">iov_base</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">client_addr</span><span class="p">,</span>
                <span class="n">N6_IS_ADDR_MULTICAST</span><span class="p">(</span><span class="n">client_addr</span><span class="p">),</span> <span class="n">now</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="n">DHCP6RELAYFORW</span> <span class="o">?</span> <span class="n">DHCPV6_SERVER_PORT</span> <span class="o">:</span> <span class="n">DHCPV6_CLIENT_PORT</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>When looking at function, there is nothing really interesting, so my first thought was that there vulnerability is in another function but affects the stack of this function. The only function that has a argument that resides in the <code class="language-plaintext highlighter-rouge">dhcp6_reply</code> is <code class="language-plaintext highlighter-rouge">dhcp6_maybe_relay</code> and the variable name is <code class="language-plaintext highlighter-rouge">state</code>.</p>

<p>Here is the <code class="language-plaintext highlighter-rouge">state struct</code>:</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>  
<span class="k">struct</span> <span class="n">state</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">clid</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">clid_len</span><span class="p">,</span> <span class="n">iaid</span><span class="p">,</span> <span class="n">ia_type</span><span class="p">,</span> <span class="n">interface</span><span class="p">,</span> <span class="n">hostname_auth</span><span class="p">,</span> <span class="n">lease_allocate</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">client_hostname</span><span class="p">,</span> <span class="o">*</span><span class="n">hostname</span><span class="p">,</span> <span class="o">*</span><span class="n">domain</span><span class="p">,</span> <span class="o">*</span><span class="n">send_domain</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dhcp_context</span> <span class="o">*</span><span class="n">context</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">in6_addr</span> <span class="o">*</span><span class="n">link_address</span><span class="p">,</span> <span class="o">*</span><span class="n">fallback</span><span class="p">,</span> <span class="o">*</span><span class="n">ll_addr</span><span class="p">,</span> <span class="o">*</span><span class="n">ula_addr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">xid</span><span class="p">,</span> <span class="n">fqdn_flags</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">iface_name</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">packet_options</span><span class="p">,</span> <span class="o">*</span><span class="n">end</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dhcp_netid</span> <span class="o">*</span><span class="n">tags</span><span class="p">,</span> <span class="o">*</span><span class="n">context_tags</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">mac</span><span class="p">[</span><span class="n">DHCP_CHADDR_MAX</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mac_len</span><span class="p">,</span> <span class="n">mac_type</span><span class="p">;</span>
<span class="cp">#ifdef OPTION6_PREFIX_CLASS
</span>	<span class="k">struct</span> <span class="n">prefix_class</span> <span class="o">*</span><span class="n">send_prefix_class</span><span class="p">;</span>
<span class="cp">#endif
</span><span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>

<p>So now lets look at  <code class="language-plaintext highlighter-rouge">dhcp6_maybe_reply()</code> and only focus on <code class="language-plaintext highlighter-rouge">state</code>. Here is the whole function :</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
</pre></td><td class="rouge-code"><pre>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">dhcp6_maybe_relay</span><span class="p">(</span><span class="k">struct</span> <span class="n">state</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">inbuff</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">sz</span><span class="p">,</span> 
			     <span class="k">struct</span> <span class="n">in6_addr</span> <span class="o">*</span><span class="n">client_addr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">is_unicast</span><span class="p">,</span> <span class="kt">time_t</span> <span class="n">now</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">void</span> <span class="o">*</span><span class="n">end</span> <span class="o">=</span> <span class="n">inbuff</span> <span class="o">+</span> <span class="n">sz</span><span class="p">;</span>
  <span class="kt">void</span> <span class="o">*</span><span class="n">opts</span> <span class="o">=</span> <span class="n">inbuff</span> <span class="o">+</span> <span class="mi">34</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">msg_type</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">inbuff</span><span class="p">);</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">outmsgtypep</span><span class="p">;</span>
  <span class="kt">void</span> <span class="o">*</span><span class="n">opt</span><span class="p">;</span>
  <span class="k">struct</span> <span class="n">dhcp_vendor</span> <span class="o">*</span><span class="n">vendor</span><span class="p">;</span>

  <span class="cm">/* if not an encapsulated relayed message, just do the stuff */</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">msg_type</span> <span class="o">!=</span> <span class="n">DHCP6RELAYFORW</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="cm">/* if link_address != NULL if points to the link address field of the 
	 innermost nested RELAYFORW message, which is where we find the
	 address of the network on which we can allocate an address.
	 Recalculate the available contexts using that information. 

      link_address == NULL means there's no relay in use, so we try and find the client's 
      MAC address from the local ND cache. */</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">link_address</span><span class="p">)</span>
	<span class="n">get_client_mac</span><span class="p">(</span><span class="n">client_addr</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">interface</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">mac</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">mac_len</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">mac_type</span><span class="p">,</span> <span class="n">now</span><span class="p">);</span>
      <span class="k">else</span>
	<span class="p">{</span>
	  <span class="k">struct</span> <span class="n">dhcp_context</span> <span class="o">*</span><span class="n">c</span><span class="p">;</span>
	  <span class="n">state</span><span class="o">-&gt;</span><span class="n">context</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	   
	  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IN6_IS_ADDR_LOOPBACK</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">link_address</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	      <span class="o">!</span><span class="n">IN6_IS_ADDR_LINKLOCAL</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">link_address</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	      <span class="o">!</span><span class="n">IN6_IS_ADDR_MULTICAST</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">link_address</span><span class="p">))</span>
	    <span class="k">for</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="n">daemon</span><span class="o">-&gt;</span><span class="n">dhcp6</span><span class="p">;</span> <span class="n">c</span><span class="p">;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span>
	      <span class="k">if</span> <span class="p">((</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">CONTEXT_DHCP</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		  <span class="o">!</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">CONTEXT_TEMPLATE</span> <span class="o">|</span> <span class="n">CONTEXT_OLD</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
		  <span class="n">is_same_net6</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">link_address</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">start6</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">prefix</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		  <span class="n">is_same_net6</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">link_address</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">end6</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">prefix</span><span class="p">))</span>
		<span class="p">{</span>
		  <span class="n">c</span><span class="o">-&gt;</span><span class="n">preferred</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">=</span> <span class="mh">0xffffffff</span><span class="p">;</span>
		  <span class="n">c</span><span class="o">-&gt;</span><span class="n">current</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">context</span><span class="p">;</span>
		  <span class="n">state</span><span class="o">-&gt;</span><span class="n">context</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
		<span class="p">}</span>
	  
	  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">context</span><span class="p">)</span>
	    <span class="p">{</span>
	      <span class="n">inet_ntop</span><span class="p">(</span><span class="n">AF_INET6</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">link_address</span><span class="p">,</span> <span class="n">daemon</span><span class="o">-&gt;</span><span class="n">addrbuff</span><span class="p">,</span> <span class="n">ADDRSTRLEN</span><span class="p">);</span> 
	      <span class="n">my_syslog</span><span class="p">(</span><span class="n">MS_DHCP</span> <span class="o">|</span> <span class="n">LOG_WARNING</span><span class="p">,</span> 
			<span class="n">_</span><span class="p">(</span><span class="s">"no address range available for DHCPv6 request from relay at %s"</span><span class="p">),</span>
			<span class="n">daemon</span><span class="o">-&gt;</span><span class="n">addrbuff</span><span class="p">);</span>
	      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span>
	  
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">context</span><span class="p">)</span>
	<span class="p">{</span>
	  <span class="n">my_syslog</span><span class="p">(</span><span class="n">MS_DHCP</span> <span class="o">|</span> <span class="n">LOG_WARNING</span><span class="p">,</span> 
		    <span class="n">_</span><span class="p">(</span><span class="s">"no address range available for DHCPv6 request via %s"</span><span class="p">),</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">iface_name</span><span class="p">);</span>
	  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

      <span class="k">return</span> <span class="n">dhcp6_no_relay</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">msg_type</span><span class="p">,</span> <span class="n">inbuff</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">is_unicast</span><span class="p">,</span> <span class="n">now</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="cm">/* must have at least msg_type+hopcount+link_address+peer_address+minimal size option
     which is               1   +    1   +    16      +     16     + 2 + 2 = 38 */</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">sz</span> <span class="o">&lt;</span> <span class="mi">38</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  
  <span class="cm">/* copy header stuff into reply message and set type to reply */</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">outmsgtypep</span> <span class="o">=</span> <span class="n">put_opt6</span><span class="p">(</span><span class="n">inbuff</span><span class="p">,</span> <span class="mi">34</span><span class="p">)))</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="o">*</span><span class="n">outmsgtypep</span> <span class="o">=</span> <span class="n">DHCP6RELAYREPL</span><span class="p">;</span>

  <span class="cm">/* look for relay options and set tags if found. */</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">vendor</span> <span class="o">=</span> <span class="n">daemon</span><span class="o">-&gt;</span><span class="n">dhcp_vendors</span><span class="p">;</span> <span class="n">vendor</span><span class="p">;</span> <span class="n">vendor</span> <span class="o">=</span> <span class="n">vendor</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="kt">int</span> <span class="n">mopt</span><span class="p">;</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="n">vendor</span><span class="o">-&gt;</span><span class="n">match_type</span> <span class="o">==</span> <span class="n">MATCH_SUBSCRIBER</span><span class="p">)</span>
	<span class="n">mopt</span> <span class="o">=</span> <span class="n">OPTION6_SUBSCRIBER_ID</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">vendor</span><span class="o">-&gt;</span><span class="n">match_type</span> <span class="o">==</span> <span class="n">MATCH_REMOTE</span><span class="p">)</span>
	<span class="n">mopt</span> <span class="o">=</span> <span class="n">OPTION6_REMOTE_ID</span><span class="p">;</span> 
      <span class="k">else</span>
	<span class="k">continue</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">((</span><span class="n">opt</span> <span class="o">=</span> <span class="n">opt6_find</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">mopt</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
	  <span class="n">vendor</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="n">opt6_len</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	  <span class="n">memcmp</span><span class="p">(</span><span class="n">vendor</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span> <span class="n">opt6_ptr</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">vendor</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
	  <span class="n">vendor</span><span class="o">-&gt;</span><span class="n">netid</span><span class="p">.</span><span class="n">next</span> <span class="o">!=</span> <span class="o">&amp;</span><span class="n">vendor</span><span class="o">-&gt;</span><span class="n">netid</span><span class="p">)</span>
	<span class="p">{</span>
	  <span class="n">vendor</span><span class="o">-&gt;</span><span class="n">netid</span><span class="p">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">tags</span><span class="p">;</span>
	  <span class="n">state</span><span class="o">-&gt;</span><span class="n">tags</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">vendor</span><span class="o">-&gt;</span><span class="n">netid</span><span class="p">;</span>
	  <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>
  
  <span class="cm">/* RFC-6939 */</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">opt</span> <span class="o">=</span> <span class="n">opt6_find</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">OPTION6_CLIENT_MAC</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="p">{</span>
      <span class="n">state</span><span class="o">-&gt;</span><span class="n">mac_type</span> <span class="o">=</span> <span class="n">opt6_uint</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
      <span class="n">state</span><span class="o">-&gt;</span><span class="n">mac_len</span> <span class="o">=</span> <span class="n">opt6_len</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>
      <span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">mac</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt6_ptr</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">mac_len</span><span class="p">);</span>
    <span class="p">}</span>
  
  <span class="k">for</span> <span class="p">(</span><span class="n">opt</span> <span class="o">=</span> <span class="n">opts</span><span class="p">;</span> <span class="n">opt</span><span class="p">;</span> <span class="n">opt</span> <span class="o">=</span> <span class="n">opt6_next</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="kt">int</span> <span class="n">o</span> <span class="o">=</span> <span class="n">new_opt6</span><span class="p">(</span><span class="n">opt6_type</span><span class="p">(</span><span class="n">opt</span><span class="p">));</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">opt6_type</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span> <span class="o">==</span> <span class="n">OPTION6_RELAY_MSG</span><span class="p">)</span>
	<span class="p">{</span>
	  <span class="k">struct</span> <span class="n">in6_addr</span> <span class="n">align</span><span class="p">;</span>
	  <span class="cm">/* the packet data is unaligned, copy to aligned storage */</span>
	  <span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">align</span><span class="p">,</span> <span class="n">inbuff</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">IN6ADDRSZ</span><span class="p">);</span> 
	  <span class="n">state</span><span class="o">-&gt;</span><span class="n">link_address</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">align</span><span class="p">;</span>
	  <span class="cm">/* zero is_unicast since that is now known to refer to the 
	     relayed packet, not the original sent by the client */</span>
	  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dhcp6_maybe_relay</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">opt6_ptr</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">opt6_len</span><span class="p">(</span><span class="n">opt</span><span class="p">),</span> <span class="n">client_addr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">now</span><span class="p">))</span>
	    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">opt6_type</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span> <span class="o">!=</span> <span class="n">OPTION6_CLIENT_MAC</span><span class="p">)</span>
	<span class="n">put_opt6</span><span class="p">(</span><span class="n">opt6_ptr</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">opt6_len</span><span class="p">(</span><span class="n">opt</span><span class="p">));</span>
      <span class="n">end_opt6</span><span class="p">(</span><span class="n">o</span><span class="p">);</span>	    
    <span class="p">}</span>
  
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Here is where the vulnerability happens:</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">((</span><span class="n">opt</span> <span class="o">=</span> <span class="n">opt6_find</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">OPTION6_CLIENT_MAC</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="p">{</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">mac_type</span> <span class="o">=</span> <span class="n">opt6_uint</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
			<span class="n">state</span><span class="o">-&gt;</span><span class="n">mac_len</span> <span class="o">=</span> <span class="n">opt6_len</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">mac</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt6_ptr</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">mac_len</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>User controlled data is copied to <code class="language-plaintext highlighter-rouge">state-&gt;mac[0]</code> using a user controlled size which is not validated by the program.</p>

<p>Lets check the size of <code class="language-plaintext highlighter-rouge">state-&gt;mac</code>. Has we have seen from the <code class="language-plaintext highlighter-rouge">state struct</code>.</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">mac</span><span class="p">[</span><span class="n">DHCP_CHADDR_MAX</span><span class="p">];</span>
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">state-&gt;mac</code> is a character buffer, <code class="language-plaintext highlighter-rouge">DHCP_CHADDR_MAX</code> is defined with size 16.</p>

<p>To confirm this vulnerability lets use a debugger to check the size of <code class="language-plaintext highlighter-rouge">state-&gt;mac_len</code> when <code class="language-plaintext highlighter-rouge">memcpy()</code> is called.</p>

<p>This vulnerability happens in <code class="language-plaintext highlighter-rouge">dhcp6_maybe_relay()</code> but it corrupts stack memory in <code class="language-plaintext highlighter-rouge">dhcp6_relay</code> because <code class="language-plaintext highlighter-rouge">state</code> is stored in that function.</p>

<p>Here is the exact corruption layout:</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>nsigned char mac[DHCP_CHADDR_MAX];
	unsigned int mac_len, mac_type;
#ifdef OPTION6_PREFIX_CLASS
	struct prefix_class *send_prefix_class;
#endif

state.mac[16]
state.mac_len 
state.mac_type
...
Stack Canary : at offset 42
saved RBP
saved RIP
</pre></td></tr></tbody></table></code></div></div>
<h3 id="the-patch"><span class="me-2">The Patch</span><a href="#the-patch" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Through source patch diffing I found out how they patched this vulnerability.</p>

<div class="language-c highlighter-rouge"><div class="code-header">
        <span data-label-text="C"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">((</span><span class="n">opt</span> <span class="o">=</span> <span class="n">opt6_find</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">OPTION6_CLIENT_MAC</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="p">{</span>
	<span class="cm">/* Patch */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">opt6_len</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="n">DHCP_CHADDR_MAX</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* End of patch */</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">mac_type</span> <span class="o">=</span> <span class="n">opt6_uint</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">mac_len</span> <span class="o">=</span> <span class="n">opt6_len</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">mac</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt6_ptr</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">mac_len</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>I check was added to ensure that the data copied into the <code class="language-plaintext highlighter-rouge">state-&gt;mac</code> buffer was less than <code class="language-plaintext highlighter-rouge">DHCP_CHADDR_MAX</code>. That is simply the patch.</p>

<p>To exploit this vulnerability (Later blog post) I will need a CVE-2017-14494 which is a information leak vulnerability.</p>

<h2 id="research--status"><span class="me-2">Research  Status</span><a href="#research--status" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>The root cause analysis for CVE-2017-14493 has been completed, including patch diffing and vulnerable code path tracing.</p>

<p>Ongoing work focuses on:</p>
<ul>
  <li>Reliable heap layout control</li>
  <li>Leveraging CVE-2017-14494 for information disclosure</li>
  <li>Evaluating exploitability under modern glibc and compiler mitigations</li>
  <li>Writing a fully reliable exploit</li>
</ul>

<p>Updates will follow as the research progresses.</p>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/research/">research</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/linux-userland/"
            class="post-tag no-text-decoration"
          >linux-userland</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=From%20CTFs%20to%20Real-World%20Exploitation:%20Root%20Cause%20Analysis%20of%20CVE-2017-14493%20in%20dnsmasq%20-%20t1b4n3&url=https%3A%2F%2Ft1b4n3.github.io%2Fpost%2FRCA-CVE-2017-14493%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=From%20CTFs%20to%20Real-World%20Exploitation:%20Root%20Cause%20Analysis%20of%20CVE-2017-14493%20in%20dnsmasq%20-%20t1b4n3&u=https%3A%2F%2Ft1b4n3.github.io%2Fpost%2FRCA-CVE-2017-14493%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=https%3A%2F%2Ft1b4n3.github.io%2Fpost%2FRCA-CVE-2017-14493%2F&text=From%20CTFs%20to%20Real-World%20Exploitation:%20Root%20Cause%20Analysis%20of%20CVE-2017-14493%20in%20dnsmasq%20-%20t1b4n3" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/post/RCA-CVE-2017-14493/">From CTFs to Real-World Exploitation: Root Cause Analysis of CVE-2017-14493 in dnsmasq</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/post/file-structure-exploitaton/">Introduction to File Structure Exploitation</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/post/pascalCTF-yetanothernotetaker/">Pascal CTF - yetanothernotetaker</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/post/house-of-botcake/">House of Botcake</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/post/house-of-spirit/">House of Spirit</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/heap-exploitation/">heap-exploitation</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/pwn/">pwn</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/tcach-poisioning/">tcach-poisioning</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/tcache/">tcache</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/fastbin-dup/">fastbin-dup</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/fastbin/">fastbin</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/file-struct-exploits/">File-Struct-Exploits</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/fsop/">fsop</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/gambling/">gambling</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/heap/">heap</a>
      
    </div>
  </section>


            </div>

            
              
              






  <div class="toc-border-cover z-3"></div>
  <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
    <h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  
    











            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/post/pascalCTF-yetanothernotetaker/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>Pascal CTF - yetanothernotetaker</p>
    </a>
  

  
    <div class="btn btn-outline-primary disabled" aria-label="Newer">
      <p>-</p>
    </div>
  
</nav>

            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>
    <time>2026</time>

    
      <a href="https://twitter.com/t1b4n3">Nkateko Tibane</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="v7.4.1"
        href="https://github.com/cotes2020/jekyll-theme-chirpy"
        target="_blank"
        rel="noopener"
      >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/heap-exploitation/">heap-exploitation</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/pwn/">pwn</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/tcach-poisioning/">tcach-poisioning</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/tcache/">tcache</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/fastbin-dup/">fastbin-dup</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/fastbin/">fastbin</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/file-struct-exploits/">File-Struct-Exploits</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/fsop/">fsop</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/gambling/">gambling</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/heap/">heap</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->

  
  <!-- https://giscus.app/ -->
<script>
  (function () {
    const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed');
    const initTheme = themeMapper[Theme.visualState];

    let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) {
      lang = lang.slice(0, 2);
    }

    let giscusAttributes = {
      src: 'https://giscus.app/client.js',
      'data-repo': 't1b4n3/t1b4n3.github.io',
      'data-repo-id': 'R_kgDOOv_aMg',
      'data-category': 'General',
      'data-category-id': 'DIC_kwDOOv_aMs4CqjgI',
      'data-mapping': 'pathname',
      'data-strict' : '0',
      'data-reactions-enabled': '1',
      'data-emit-metadata': '0',
      'data-theme': initTheme,
      'data-input-position': 'bottom',
      'data-lang': lang,
      'data-loading': 'lazy',
      crossorigin: 'anonymous',
      async: ''
    };

    let giscusNode = document.createElement('script');
    Object.entries(giscusAttributes).forEach(([key, value]) =>
      giscusNode.setAttribute(key, value)
    );

    const $footer = document.querySelector('footer');
    $footer.insertAdjacentElement("beforebegin", giscusNode);

    addEventListener('message', (event) => {
      if (event.source === window && event.data && event.data.id === Theme.ID) {
        const newTheme = themeMapper[Theme.visualState];

        const message = {
          setConfig: {
            theme: newTheme
          }
        };

        const giscus =
          document.getElementsByClassName('giscus-frame')[0].contentWindow;
        giscus.postMessage({ giscus: message }, 'https://giscus.app');
      }
    });
  })();
</script>



    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{content}</p>  </article>',
      noResultsText: '<p class="mt-5">Oops! No results found.</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>

  </body>
</html>

